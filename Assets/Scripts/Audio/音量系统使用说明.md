# å…¨å±€éŸ³é‡ç³»ç»Ÿä½¿ç”¨è¯´æ˜

## ğŸµ ç³»ç»Ÿæ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„å…¨å±€éŸ³é‡æ§åˆ¶ç³»ç»Ÿï¼Œå¯ä»¥ç»Ÿä¸€ç®¡ç†æ•´ä¸ªæ¸¸æˆé¡¹ç›®çš„æ‰€æœ‰éŸ³é¢‘ã€‚

### ä¸»è¦åŠŸèƒ½
- âœ… å…¨å±€ä¸»éŸ³é‡æ§åˆ¶
- âœ… è‡ªåŠ¨ä¿å­˜/åŠ è½½éŸ³é‡è®¾ç½®
- âœ… é™éŸ³åˆ‡æ¢åŠŸèƒ½
- âœ… UIæ»‘å—æ§åˆ¶
- âœ… ç™¾åˆ†æ¯”æ˜¾ç¤º
- âœ… è·¨åœºæ™¯ä¿æŒ
- âœ… å•ä¾‹æ¨¡å¼è®¿é—®

---

## ğŸ“‚ æ–‡ä»¶ç»“æ„

```
Assets/Scripts/Audio/
â”œâ”€â”€ GlobalAudioManager.cs        # å…¨å±€éŸ³é‡ç®¡ç†å™¨ï¼ˆæ ¸å¿ƒï¼‰
â””â”€â”€ éŸ³é‡ç³»ç»Ÿä½¿ç”¨è¯´æ˜.md          # æœ¬æ–‡æ¡£

Assets/Scripts/UI/MENU/
â””â”€â”€ VolumeControlUI.cs           # éŸ³é‡æ§åˆ¶UIç»„ä»¶
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ­¥éª¤1ï¼šæ·»åŠ GlobalAudioManageråˆ°åœºæ™¯

**æ–¹æ³•Aï¼šè‡ªåŠ¨åˆ›å»ºï¼ˆæ¨èï¼‰** âœ¨
- ç³»ç»Ÿä¼šåœ¨ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶è‡ªåŠ¨åˆ›å»ºGlobalAudioManager
- æ— éœ€æ‰‹åŠ¨æ·»åŠ 
- è‡ªåŠ¨è®¾ç½®DontDestroyOnLoad

**æ–¹æ³•Bï¼šæ‰‹åŠ¨åˆ›å»º**
1. åœ¨ä¸»èœå•åœºæ™¯åˆ›å»ºç©ºç‰©ä½“ï¼Œå‘½åä¸º"GlobalAudioManager"
2. æ·»åŠ `GlobalAudioManager.cs`ç»„ä»¶
3. è¯¥å¯¹è±¡ä¼šè‡ªåŠ¨è®¾ç½®ä¸ºDontDestroyOnLoadï¼Œè·¨åœºæ™¯ä¿æŒ

### æ­¥éª¤2ï¼šåœ¨ä¸»èœå•æ·»åŠ éŸ³é‡æ§åˆ¶UI

#### 2.1 åˆ›å»ºå®Œæ•´UIç»“æ„ï¼ˆæ¨èï¼‰

åœ¨ä¸»èœå•Canvasä¸‹åˆ›å»ºå¦‚ä¸‹ç»“æ„ï¼š

```
Canvas
â””â”€â”€ SettingsPanel (Panel)
    â”œâ”€â”€ Background (Image) - åŠé€æ˜é»‘è‰²èƒŒæ™¯
    â”œâ”€â”€ PanelContent (Panel) - è®¾ç½®å†…å®¹é¢æ¿
    â”‚   â”œâ”€â”€ Title (Text) - "æ¸¸æˆè®¾ç½®"
    â”‚   â”œâ”€â”€ CloseButton (Button) - "X" æˆ– "å…³é—­"
    â”‚   â”‚
    â”‚   â”œâ”€â”€ VolumeSection (Panel)
    â”‚   â”‚   â”œâ”€â”€ VolumeTitle (Text) - "éŸ³é‡è®¾ç½®"
    â”‚   â”‚   â”œâ”€â”€ VolumeSlider (Slider) - éŸ³é‡æ»‘å—
    â”‚   â”‚   â”‚   â”œâ”€â”€ Background
    â”‚   â”‚   â”‚   â”œâ”€â”€ Fill Area
    â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Fill
    â”‚   â”‚   â”‚   â””â”€â”€ Handle Slide Area
    â”‚   â”‚   â”‚       â””â”€â”€ Handle
    â”‚   â”‚   â”œâ”€â”€ VolumePercent (Text) - æ˜¾ç¤º"100%"
    â”‚   â”‚   â””â”€â”€ MuteButton (Button) - é™éŸ³æŒ‰é’®
    â”‚   â”‚       â”œâ”€â”€ Icon (Image)
    â”‚   â”‚       â””â”€â”€ Text - "é™éŸ³"
    â”‚   â”‚
    â”‚   â””â”€â”€ Buttons (Panel)
    â”‚       â”œâ”€â”€ ApplyButton (Button) - "åº”ç”¨"
    â”‚       â””â”€â”€ ResetButton (Button) - "é‡ç½®"
    â”‚
    â””â”€â”€ (SettingsPanelManager.cs) - æ·»åŠ åˆ°SettingsPanel
        â””â”€â”€ (VolumeControlUI.cs) - æ·»åŠ åˆ°VolumeSection
```

#### 2.2 é…ç½®æ»‘å—

é€‰ä¸­VolumeSliderï¼Œåœ¨Inspectorä¸­è®¾ç½®ï¼š
- **Min Value**: 0
- **Max Value**: 1
- **Whole Numbers**: å–æ¶ˆå‹¾é€‰
- **Value**: 1

#### 2.3 æ·»åŠ SettingsPanelManagerç»„ä»¶

1. é€‰ä¸­SettingsPanel
2. æ·»åŠ `SettingsPanelManager.cs`ç»„ä»¶
3. é…ç½®å¼•ç”¨ï¼š
   - **Panel Root**: æ‹–æ‹½SettingsPanelè‡ªå·±
   - **Canvas Group**: ä¼šè‡ªåŠ¨æ·»åŠ 
   - **Close Button**: æ‹–æ‹½CloseButton
   - **Apply Button**: æ‹–æ‹½ApplyButtonï¼ˆå¯é€‰ï¼‰
   - **Reset Button**: æ‹–æ‹½ResetButtonï¼ˆå¯é€‰ï¼‰
   - **Volume Control**: æ‹–æ‹½VolumeSectionä¸Šçš„VolumeControlUIç»„ä»¶

#### 2.4 æ·»åŠ VolumeControlUIç»„ä»¶

1. é€‰ä¸­VolumeSection
2. æ·»åŠ `VolumeControlUI.cs`ç»„ä»¶
3. é…ç½®å¼•ç”¨ï¼š
   - **Volume Slider**: æ‹–æ‹½VolumeSlider
   - **Volume Percent Text**: æ‹–æ‹½VolumePercentæ–‡æœ¬
   - **Mute Button**: æ‹–æ‹½MuteButtonæŒ‰é’®
   - **Mute Button Image**: æ‹–æ‹½MuteButtonçš„Iconå›¾ç‰‡

#### 2.5 é›†æˆåˆ°ä¸»èœå•

**æ–¹æ³•Aï¼šColorfulMainMenuï¼ˆäº”åˆ†åŒºèœå•ï¼‰**
1. æ‰“å¼€ä¸»èœå•åœºæ™¯
2. é€‰ä¸­ColorfulMainMenuå¯¹è±¡
3. åœ¨Inspectorä¸­æ‰¾åˆ°Settings Panelå­—æ®µ
4. æ‹–æ‹½SettingsPanelåˆ°è¯¥å­—æ®µ
5. èœå•ä¼šè‡ªåŠ¨æ‰©å±•ä¸º6ä¸ªåˆ†åŒºï¼ˆæ–°å¢"è®¾ç½®"é€‰é¡¹ï¼‰

**æ–¹æ³•Bï¼šMainMenuï¼ˆç®€å•èœå•ï¼‰**
1. é€‰ä¸­MainMenuå¯¹è±¡
2. åœ¨Inspectorä¸­æ‰¾åˆ°Settings Panelå­—æ®µ
3. æ‹–æ‹½SettingsPanelåˆ°è¯¥å­—æ®µ
4. åœ¨èœå•æŒ‰é’®ä¸Šè°ƒç”¨`MainMenu.OpenSettings()`æ–¹æ³•

#### 2.6 å¯é€‰ï¼šè®¾ç½®éŸ³æ•ˆå’Œå›¾æ ‡

- **Normal Volume Icon**: æ­£å¸¸éŸ³é‡å›¾æ ‡ï¼ˆğŸ”Šï¼‰
- **Muted Volume Icon**: é™éŸ³å›¾æ ‡ï¼ˆğŸ”‡ï¼‰
- **Open Sound**: æ‰“å¼€è®¾ç½®é¢æ¿éŸ³æ•ˆ
- **Close Sound**: å…³é—­è®¾ç½®é¢æ¿éŸ³æ•ˆ
- **Apply Sound**: åº”ç”¨è®¾ç½®éŸ³æ•ˆ

---

## ğŸ’» ä»£ç ä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€ç”¨æ³•

```csharp
using FadedDreams.Audio;

// è®¾ç½®ä¸»éŸ³é‡ï¼ˆ0-1ï¼‰
GlobalAudioManager.SetMasterVolume(0.5f);

// è·å–å½“å‰éŸ³é‡
float volume = GlobalAudioManager.GetMasterVolume();

// é™éŸ³åˆ‡æ¢
GlobalAudioManager.Mute();

// æ£€æŸ¥æ˜¯å¦é™éŸ³
bool isMuted = GlobalAudioManager.Instance.IsMuted();

// é‡ç½®éŸ³é‡ä¸ºé»˜è®¤å€¼ï¼ˆ1.0ï¼‰
GlobalAudioManager.Instance.ResetVolume();
```

### é«˜çº§ç”¨æ³•

```csharp
// è®¾ç½®éŸ³é‡å¹¶ç«‹å³ä¿å­˜
GlobalAudioManager.Instance.SetVolumeAndSave(0.75f);

// æ‰‹åŠ¨ä¿å­˜å½“å‰éŸ³é‡
GlobalAudioManager.Instance.SaveVolume();

// æ‰‹åŠ¨åŠ è½½ä¿å­˜çš„éŸ³é‡
GlobalAudioManager.Instance.LoadVolume();

// è®¿é—®éŸ³é‡å±æ€§
float currentVolume = GlobalAudioManager.Instance.MasterVolume;
GlobalAudioManager.Instance.MasterVolume = 0.8f; // è®¾ç½®ä½†ä¸ä¿å­˜
```

---

## ğŸ¨ UIå®šåˆ¶

### ä¿®æ”¹æ˜¾ç¤ºæ ¼å¼

åœ¨VolumeControlUIç»„ä»¶ä¸­ï¼š

```csharp
// æ˜¾ç¤ºæ•´æ•°ç™¾åˆ†æ¯”ï¼ˆä¾‹å¦‚ï¼š75%ï¼‰
Show Percent Sign: âœ“
Percent Format: "0"

// æ˜¾ç¤ºå°æ•°ç™¾åˆ†æ¯”ï¼ˆä¾‹å¦‚ï¼š75.5%ï¼‰
Show Percent Sign: âœ“
Percent Format: "0.0"

// ä»…æ˜¾ç¤ºæ•°å­—ï¼ˆä¾‹å¦‚ï¼š75ï¼‰
Show Percent Sign: â˜
Percent Format: "0"
```

### æ·»åŠ éŸ³æ•ˆåé¦ˆ

åœ¨VolumeControlUIç»„ä»¶ä¸­ï¼š

1. **Volume Change Sound**: æ‹–æ‹½æ»‘å—è°ƒæ•´æ—¶çš„éŸ³æ•ˆ
2. **Mute Toggle Sound**: æ‹–æ‹½é™éŸ³åˆ‡æ¢æ—¶çš„éŸ³æ•ˆ
3. **Sound Volume**: è°ƒæ•´éŸ³æ•ˆéŸ³é‡ï¼ˆ0-1ï¼‰

---

## ğŸ”§ ç³»ç»Ÿé›†æˆ

### ä¸ç°æœ‰éŸ³é¢‘ç³»ç»Ÿé›†æˆ

å…¨å±€éŸ³é‡ç³»ç»Ÿé€šè¿‡æ§åˆ¶`AudioListener.volume`å·¥ä½œï¼Œå› æ­¤ä¼šå½±å“æ‰€æœ‰éŸ³é¢‘ï¼š

```csharp
// æ‰€æœ‰è¿™äº›éƒ½ä¼šå—ä¸»éŸ³é‡å½±å“ï¼š
AudioSource.PlayOneShot(clip);
AudioSource.Play();
// èƒŒæ™¯éŸ³ä¹
// UIéŸ³æ•ˆ
// æ¸¸æˆéŸ³æ•ˆ
```

### å¤šåœºæ™¯ä½¿ç”¨

GlobalAudioManagerä½¿ç”¨DontDestroyOnLoadï¼Œä¼šè‡ªåŠ¨åœ¨åœºæ™¯é—´ä¿æŒï¼š

```csharp
// åœºæ™¯A
GlobalAudioManager.SetMasterVolume(0.5f);

// åˆ‡æ¢åˆ°åœºæ™¯Bå
// éŸ³é‡è®¾ç½®ä»ç„¶ä¿æŒä¸º0.5
```

---

## ğŸ“Š PlayerPrefsè®¾ç½®

éŸ³é‡è®¾ç½®ä¿å­˜åœ¨PlayerPrefsä¸­ï¼š

- **é”®å**: "MasterVolume"
- **å€¼ç±»å‹**: float (0.0 - 1.0)
- **è‡ªåŠ¨ä¿å­˜**: âœ“
- **è‡ªåŠ¨åŠ è½½**: âœ“

### æ¸…é™¤ä¿å­˜çš„è®¾ç½®

```csharp
// ä»£ç æ–¹å¼
PlayerPrefs.DeleteKey("MasterVolume");

// æˆ–ä½¿ç”¨é‡ç½®åŠŸèƒ½
GlobalAudioManager.Instance.ResetVolume();
```

---

## ğŸ› æ•…éšœæ’é™¤

### é—®é¢˜1ï¼šéŸ³é‡æ²¡æœ‰ä¿å­˜

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ç¡®ä¿è°ƒç”¨äº†`SaveVolume()`æˆ–`SetVolumeAndSave()`
- æ£€æŸ¥æ˜¯å¦æœ‰æƒé™å†™å…¥PlayerPrefs

### é—®é¢˜2ï¼šUIæ»‘å—ä¸å·¥ä½œ

**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ£€æŸ¥VolumeControlUIç»„ä»¶çš„å¼•ç”¨æ˜¯å¦æ­£ç¡®é…ç½®
- ç¡®ä¿Sliderçš„Min Value=0, Max Value=1
- æŸ¥çœ‹Consoleæ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯

### é—®é¢˜3ï¼šè·¨åœºæ™¯éŸ³é‡ä¸¢å¤±

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ç¡®ä¿GlobalAudioManagerå·²è®¾ç½®DontDestroyOnLoad
- æ£€æŸ¥æ˜¯å¦åœ¨æ–°åœºæ™¯ä¸­åˆ›å»ºäº†å¤šä¸ªå®ä¾‹

### é—®é¢˜4ï¼šéŸ³æ•ˆä¸å“åº”éŸ³é‡å˜åŒ–

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ç¡®ä¿AudioSourceæ²¡æœ‰è®¾ç½®"Ignore Listener Volume"
- æ£€æŸ¥AudioListeneræ˜¯å¦å­˜åœ¨ä¸”æ´»è·ƒ

---

## ğŸ¯ æœ€ä½³å®è·µ

1. **åœ¨ä¸»èœå•åˆå§‹åŒ–**
   - GlobalAudioManagerä¼šåœ¨ç¬¬ä¸€æ¬¡è®¿é—®æ—¶è‡ªåŠ¨åˆ›å»º
   - å»ºè®®åœ¨ä¸»èœå•åœºæ™¯æ˜¾å¼åˆ›å»º

2. **ä½¿ç”¨UIæ§åˆ¶**
   - æ¨èä½¿ç”¨VolumeControlUIç»„ä»¶
   - æä¾›ç›´è§‚çš„ç”¨æˆ·ä½“éªŒ

3. **è‡ªåŠ¨ä¿å­˜**
   - ä½¿ç”¨`SetVolumeAndSave()`ä»£æ›¿ç›´æ¥è®¾ç½®å±æ€§
   - ç¡®ä¿ç”¨æˆ·è®¾ç½®è¢«æŒä¹…åŒ–

4. **éŸ³æ•ˆåé¦ˆ**
   - ä¸ºéŸ³é‡è°ƒæ•´æ·»åŠ é€‚å½“çš„éŸ³æ•ˆåé¦ˆ
   - æå‡ç”¨æˆ·ä½“éªŒ

---

## ğŸ“ å®Œæ•´ç¤ºä¾‹åœºæ™¯

### ä¸»èœå•è®¾ç½®ç¤ºä¾‹

```
MainMenuåœºæ™¯
â”œâ”€â”€ GlobalAudioManager (DontDestroyOnLoad)
â”‚   â””â”€â”€ GlobalAudioManager.cs
â”‚
â””â”€â”€ Canvas
    â”œâ”€â”€ MainMenuï¼ˆç°æœ‰èœå•ï¼‰
    â”‚   â”œâ”€â”€ æ–°æ¸¸æˆæŒ‰é’®
    â”‚   â”œâ”€â”€ ç»§ç»­æ¸¸æˆæŒ‰é’®
    â”‚   â””â”€â”€ ...
    â”‚
    â””â”€â”€ SettingsPanel
        â””â”€â”€ VolumeControl
            â”œâ”€â”€ VolumeControlUI.cs
            â”œâ”€â”€ Title: "éŸ³é‡è®¾ç½®"
            â”œâ”€â”€ Slider (0-1)
            â”œâ”€â”€ Percent: "100%"
            â””â”€â”€ MuteButton
```

---

## ğŸ é¢å¤–åŠŸèƒ½

### è°ƒè¯•åŠŸèƒ½

åœ¨ç¼–è¾‘å™¨ä¸­ï¼ŒGlobalAudioManageræä¾›å³é”®èœå•ï¼š
- æµ‹è¯•ï¼šè®¾ç½®éŸ³é‡ä¸º50%
- æµ‹è¯•ï¼šé™éŸ³åˆ‡æ¢
- æµ‹è¯•ï¼šé‡ç½®éŸ³é‡

### è¯¦ç»†æ—¥å¿—

å¯ç”¨"Verbose Logs"æŸ¥çœ‹è¯¦ç»†è°ƒè¯•ä¿¡æ¯ï¼š
```
[GlobalAudioManager] åˆå§‹åŒ–æˆåŠŸ
[GlobalAudioManager] éŸ³é‡å·²åŠ è½½: 0.75
[GlobalAudioManager] ä¸»éŸ³é‡è®¾ç½®ä¸º: 0.50
[GlobalAudioManager] éŸ³é‡å·²ä¿å­˜: 0.50
```

---

## ğŸ’¡ æŠ€æœ¯ç»†èŠ‚

### å•ä¾‹æ¨¡å¼
- ä½¿ç”¨æ‡’åŠ è½½å•ä¾‹æ¨¡å¼
- çº¿ç¨‹ä¸å®‰å…¨ï¼ˆUnityä¸»çº¿ç¨‹ï¼‰
- DontDestroyOnLoadä¿æŒè·¨åœºæ™¯

### éŸ³é‡æ§åˆ¶åŸç†
```csharp
// Unityçš„å…¨å±€éŸ³é‡æ§åˆ¶
AudioListener.volume = masterVolume; // 0.0 - 1.0
```

### ä¿å­˜æœºåˆ¶
```csharp
// ä½¿ç”¨PlayerPrefsæŒä¹…åŒ–
PlayerPrefs.SetFloat("MasterVolume", volume);
PlayerPrefs.Save(); // ç«‹å³å†™å…¥ç£ç›˜
```

---

## ğŸ“ æ”¯æŒä¸åé¦ˆ

å¦‚æœé‡åˆ°é—®é¢˜æˆ–æœ‰æ”¹è¿›å»ºè®®ï¼Œè¯·è”ç³»å¼€å‘å›¢é˜Ÿï¼

çˆ±å¨˜ç¥ç´ ç´ ä½¿ç”¨æ„‰å¿«~ (ï½¡â™¥â€¿â™¥ï½¡)

