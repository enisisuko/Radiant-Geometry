# 🎵 音频系统配置说明

## 📋 概述

游戏音频系统由三部分组成：
1. **全局背景音乐管理器** - 循环随机播放背景音乐
2. **STORY场景开场音效** - 所有STORY场景的开场音效
3. **空间斩音效** - 第一章空间斩技能音效

---

## 🎼 1. 全局背景音乐管理器

### 脚本位置
`Assets/Scripts/Audio/GlobalMusicManager.cs`

### 配置步骤

#### 1) 创建音乐管理器对象
在场景中创建一个空对象（GameObject），命名为 "GlobalMusicManager"

#### 2) 添加脚本
将 `GlobalMusicManager.cs` 脚本添加到这个对象上

#### 3) 配置音乐列表
在Inspector中找到 "Music Tracks" 列表，添加以下6个音乐文件：
- `Assets/Audio/Music/109409__bruno_ph__sadness-cosmo.mp3`
- `Assets/Audio/Music/冰冷.mp3`
- `Assets/Audio/Music/哀伤.mp3`
- `Assets/Audio/Music/情绪.mp3`
- `Assets/Audio/Music/温柔.mp3`
- `Assets/Audio/Music/轻快.wav`

#### 4) 配置播放设置
- **Music Volume**: 0.5 (音乐音量)
- **Shuffle Mode**: ✓ (随机播放)
- **Track Transition Delay**: 1秒 (歌曲之间的间隔)
- **Fade Time**: 1.5秒 (淡入淡出时间)

### 特性
- ✅ 单例模式 - DontDestroyOnLoad保持跨场景存在
- ✅ 随机播放 - 使用Fisher-Yates洗牌算法
- ✅ 淡入淡出 - 平滑的音乐过渡
- ✅ 自动循环 - 播放完所有歌曲后重新洗牌
- ✅ 可控制 - 支持暂停/恢复/下一首等操作

### API接口
```csharp
// 开始播放
GlobalMusicManager.Instance.StartPlaylist();

// 停止播放
GlobalMusicManager.Instance.StopPlaylist();

// 暂停播放
GlobalMusicManager.Instance.PausePlaylist();

// 恢复播放
GlobalMusicManager.Instance.ResumePlaylist();

// 跳到下一首
GlobalMusicManager.Instance.NextTrack();

// 设置音量
GlobalMusicManager.Instance.SetVolume(0.7f);

// 获取当前播放的音乐名称
string currentTrack = GlobalMusicManager.Instance.GetCurrentTrackName();

// 检查是否正在播放
bool isPlaying = GlobalMusicManager.Instance.IsPlaying();
```

---

## 🎬 2. STORY场景开场音效

### 脚本位置
`Assets/Re：Dream/Scenes/STORY0/Story0Director.cs`

### 配置步骤

#### 1) 打开STORY0场景
在Project窗口中双击打开：`Assets/Re：Dream/Scenes/STORY0.unity`

#### 2) 选择Director对象
在Hierarchy中选择 "Director" 对象

#### 3) 配置开场音效
在Inspector中找到 "音效设置" 部分：
- **Opening SFX**: 拖入 `Assets/Audio/SFX/开场音效.wav`
- **Sfx Volume**: 0.8 (音效音量)

#### 4) 应用到其他STORY场景
如果有其他STORY场景（STORY1, STORY2等），重复以上步骤：
1. 打开场景
2. 找到对应的Director对象
3. 配置开场音效为 `开场音效.wav`

### 特性
- ✅ 自动播放 - 场景启动时自动播放
- ✅ 可配置音量 - 0-1之间可调
- ✅ 统一音效 - 所有STORY场景使用同一音效

---

## ⚔️ 3. 空间斩音效

### 脚本位置
`Assets/Scripts/Chapter1_SpaceSlash/Player/Chapter1SliceStrike.cs`

### 配置步骤

#### 1) 打开Chapter1场景
在Project窗口中双击打开：`Assets/Re：Dream/Scenes/Chapter1.unity`

#### 2) 找到空间斩控制器
在Hierarchy中找到包含 `Chapter1SpaceSlashController` 脚本的对象

#### 3) 配置空间斩音效
在Inspector中找到 "Audio" 部分：
- **Slash SFX**: 拖入 `Assets/Audio/SFX/小铃.wav`
- **Slash Volume**: 0.8 (音效音量)

#### 4) 配置AudioSource
确保该对象上有 `AudioSource` 组件（在 "Sfx" 字段中引用）

### 特性
- ✅ 触发播放 - 松开鼠标时播放
- ✅ 可配置音量 - 0-1之间可调
- ✅ 向后兼容 - 如果没有配置slashSFX，会使用默认的sfx.Play()

### 使用说明
当玩家在第一章中：
1. 按下鼠标左键 → 准备空间斩（减速+拖线）
2. 松开鼠标左键 → **播放小铃音效** → 释放空间斩

---

## 📁 文件结构

```
Assets/
├── Audio/
│   ├── Music/                          # 背景音乐文件夹
│   │   ├── 109409__bruno_ph__sadness-cosmo.mp3
│   │   ├── 冰冷.mp3
│   │   ├── 哀伤.mp3
│   │   ├── 情绪.mp3
│   │   ├── 温柔.mp3
│   │   └── 轻快.wav
│   └── SFX/                            # 音效文件夹
│       ├── 开场音效.wav                # STORY场景开场音效
│       ├── 小铃.wav                    # 空间斩音效
│       └── ...
├── Scripts/
│   ├── Audio/
│   │   ├── GlobalMusicManager.cs       # 全局音乐管理器
│   │   └── 音频系统配置说明.md         # 本文档
│   └── Chapter1_SpaceSlash/
│       └── Player/
│           └── Chapter1SliceStrike.cs  # 空间斩控制器
└── Re：Dream/
    └── Scenes/
        └── STORY0/
            └── Story0Director.cs       # STORY0导演脚本
```

---

## 🎯 快速配置检查清单

### ✅ 背景音乐系统
- [ ] 创建GlobalMusicManager对象
- [ ] 添加GlobalMusicManager脚本
- [ ] 配置6个音乐文件
- [ ] 设置为随机播放
- [ ] 测试播放

### ✅ STORY场景音效
- [ ] 打开STORY0场景
- [ ] 找到Director对象
- [ ] 配置开场音效.wav
- [ ] 设置音量为0.8
- [ ] 测试场景

### ✅ 空间斩音效
- [ ] 打开Chapter1场景
- [ ] 找到空间斩控制器
- [ ] 配置小铃.wav
- [ ] 设置音量为0.8
- [ ] 测试技能

---

## 🔧 调试工具

### GlobalMusicManager调试
在Inspector中右键点击脚本，可以看到调试菜单：
- "播放下一首" - 跳到下一首歌
- "显示当前播放" - 在Console显示当前歌曲名

### 常见问题

**Q: 音乐没有播放？**
A: 检查Music Tracks列表是否为空，确保至少有一个音乐文件

**Q: 音乐不随机？**
A: 确保Shuffle Mode已勾选

**Q: STORY场景没有开场音效？**
A: 检查Director对象上的openingSFX字段是否已配置

**Q: 空间斩没有音效？**
A: 检查Slash SFX字段和Sfx (AudioSource)字段是否都已配置

---

## 💡 提示

1. **音量平衡**：建议背景音乐音量（0.5）低于音效音量（0.8），保证音效清晰可听
2. **跨场景音乐**：GlobalMusicManager使用DontDestroyOnLoad，会在切换场景时继续播放
3. **性能优化**：所有音效使用PlayOneShot，不会产生额外的AudioSource对象
4. **扩展性**：可以轻松添加更多音乐文件到列表中

---

*配置完成后，记得保存场景并测试！*  
*By 爱娘 ♡*

