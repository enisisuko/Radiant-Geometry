# 流体色块菜单系统 - 产品需求文档 (PRD)

## 1. 项目概述

### 1.1 产品名称
**流体色块菜单系统 (Fluid Color Block Menu System)**

### 1.2 产品定位
为《小天使大冒险》游戏设计一个全新的主菜单界面，采用创新的流体交互设计，提供沉浸式的视觉体验和流畅的操作感受。

### 1.3 设计理念
- **流体美学**：模拟真实流体的挤压和变形效果
- **光感设计**：发光色块营造科技感和未来感
- **直观交互**：悬停即反馈，点击即响应
- **空间利用**：四角+中心布局最大化屏幕空间利用

## 2. 功能需求

### 2.1 核心功能

#### 2.1.1 菜单选项
| 选项 | 位置 | 功能 | 状态 |
|------|------|------|------|
| 新游戏 | 左上角 | 开始全新游戏，清空存档 | ✅ 已实现 |
| 继续游戏 | 正中心 | 从上次保存点继续 | ✅ 已实现 |
| 双人模式 | 右上角 | 本地/在线双人游戏 | ❌ 待开发 |
| 退出游戏 | 右下角 | 退出到桌面 | ✅ 已实现 |
| 支持我 | 左下角 | 打赏/支持页面 | ❌ 待开发 |

#### 2.1.2 交互行为
- **悬停效果**：鼠标悬停时色块变亮、扩大，挤压其他色块
- **点击效果**：点击后目标色块扩展至全屏，其他色块被挤出屏幕
- **键盘支持**：数字键1-5快速选择对应选项
- **ESC键**：快速退出游戏

### 2.2 视觉需求

#### 2.2.1 布局设计
```
┌─────────────────────────────────────┐
│  新游戏     │         │    双人模式   │
│  (左上)     │ 继续游戏 │     (右上)   │
│             │  (中心)  │             │
├─────────────┼─────────┼─────────────┤
│             │         │             │
│  支持我     │         │    退出游戏   │
│  (左下)     │         │     (右下)   │
└─────────────────────────────────────┘
```

#### 2.2.2 配色方案
| 选项 | 主色调 | 渐变范围 | 发光强度 |
|------|--------|----------|----------|
| 新游戏 | 青蓝色 | #00D9FF → #0077FF | 高 |
| 继续游戏 | 柔和紫 | #B967FF → #7B2FFF | 最高 |
| 双人模式 | 活力橙 | #FF9A56 → #FF6B35 | 中 |
| 退出游戏 | 暗红色 | #FF6B6B → #C92A2A | 低 |
| 支持我 | 温暖金 | #FFD93D → #FFB319 | 中 |

#### 2.2.3 动画效果
- **呼吸效果**：所有色块持续缓慢缩放（1.0x → 1.05x）
- **悬停放大**：目标色块放大至1.5倍
- **挤压效果**：其他色块缩小至0.7倍
- **流体变形**：Shader实现的真实流体挤压感
- **波纹扩散**：悬停时产生向外扩散的波纹效果

### 2.3 技术需求

#### 2.3.1 Shader要求
- **URP兼容**：支持Universal Render Pipeline
- **流体变形**：基于压力场的顶点位移
- **发光效果**：Emission + Bloom后处理
- **边缘柔和**：Soft edges + 透明度渐变
- **性能优化**：单Pass渲染，支持GPU Instancing

#### 2.3.2 性能指标
- **帧率**：稳定60FPS（目标设备）
- **内存**：材质共享，避免实例化
- **加载时间**：菜单场景加载 < 2秒
- **响应延迟**：悬停反馈 < 50ms

## 3. 用户体验设计

### 3.1 交互流程

#### 3.1.1 正常流程
1. **进入菜单**：淡入效果，色块依次出现
2. **悬停反馈**：鼠标移动，色块实时响应
3. **选择确认**：点击或按键确认选择
4. **过渡动画**：流体挤压 + 全屏扩展
5. **功能执行**：加载场景/退出/显示页面

#### 3.1.2 异常处理
- **无存档继续**：继续游戏按钮变灰，显示提示
- **加载失败**：显示错误信息，返回菜单
- **网络异常**：双人模式显示离线提示

### 3.2 可访问性
- **色盲友好**：除颜色外，还有形状和位置区分
- **键盘导航**：完整的键盘操作支持
- **视觉反馈**：悬停和点击都有明确的视觉反馈

## 4. 技术实现

### 4.1 架构设计

#### 4.1.1 核心组件
```
FluidMenuManager (主控制器)
├── FluidColorBlock[] (色块组件)
├── FluidAnimationController (动画控制器)
├── FluidMenuInput (输入处理)
└── FluidColorBlock.shader (流体Shader)
```

#### 4.1.2 数据流
```
用户输入 → 输入检测 → 状态更新 → 动画计算 → Shader参数 → 视觉反馈
```

### 4.2 关键技术点

#### 4.2.1 流体挤压算法
```csharp
// 压力场计算
Vector2 pressure = CalculatePressureField(hoveredBlockIndex);
float squeezeFactor = Mathf.Clamp01(pressure.magnitude / maxPressure);

// 尺寸调整
float targetScale = baseScale * (1f - squeezeFactor * 0.3f);
currentScale = Mathf.SmoothDamp(currentScale, targetScale, ref velocity, 0.2f);
```

#### 4.2.2 Shader参数
- `_EmissionColor`：发光颜色
- `_EmissionIntensity`：发光强度
- `_PressureField`：压力场数据
- `_Time`：时间参数（用于动画）
- `_DistortionStrength`：变形强度

### 4.3 性能优化

#### 4.3.1 渲染优化
- 使用MaterialPropertyBlock避免材质实例化
- 合并DrawCall，减少渲染批次
- 合理使用LOD，远距离简化效果

#### 4.3.2 内存优化
- 材质共享，避免重复创建
- 对象池管理，复用UI元素
- 及时释放不用的资源

## 5. 开发计划

### 5.1 开发阶段

#### 阶段1：基础框架 (3天)
- [x] 创建项目结构
- [ ] 开发基础Shader
- [ ] 实现核心脚本框架
- [ ] 创建测试场景

#### 阶段2：核心功能 (5天)
- [ ] 完成流体挤压效果
- [ ] 实现交互检测系统
- [ ] 集成现有系统（SaveSystem、SceneLoader）
- [ ] 基础功能测试

#### 阶段3：视觉优化 (3天)
- [ ] 完善Shader效果
- [ ] 添加后期处理（Bloom）
- [ ] 优化动画曲线
- [ ] 性能调优

#### 阶段4：功能完善 (2天)
- [ ] 实现双人模式占位符
- [ ] 实现支持我页面
- [ ] 添加音效支持
- [ ] 最终测试和修复

### 5.2 里程碑
- **M1**：基础框架完成，可显示5个色块
- **M2**：交互功能完成，悬停和点击响应正常
- **M3**：流体效果完成，视觉效果达到预期
- **M4**：功能集成完成，可正常使用所有菜单功能

## 6. 测试计划

### 6.1 功能测试
- [ ] 所有菜单选项点击响应
- [ ] 键盘快捷键正常工作
- [ ] 存档系统集成正常
- [ ] 场景跳转功能正常

### 6.2 性能测试
- [ ] 帧率稳定性测试
- [ ] 内存使用监控
- [ ] 加载时间测试
- [ ] 长时间运行稳定性

### 6.3 兼容性测试
- [ ] 不同分辨率适配
- [ ] 不同设备性能测试
- [ ] 输入设备兼容性
- [ ] 平台兼容性（Windows/Mac）

## 7. 风险评估

### 7.1 技术风险
- **Shader复杂度**：流体效果可能影响性能
- **动画同步**：多个色块动画的同步问题
- **平台兼容**：不同GPU的Shader兼容性

### 7.2 解决方案
- 提供简化版本的Shader作为备选
- 使用统一的动画时间轴管理
- 进行充分的平台测试和优化

## 8. 成功标准

### 8.1 功能标准
- ✅ 所有菜单功能正常工作
- ✅ 交互响应流畅自然
- ✅ 视觉效果达到设计预期
- ✅ 性能指标满足要求

### 8.2 用户体验标准
- 用户能够直观理解界面操作
- 交互反馈及时准确
- 视觉效果令人印象深刻
- 整体体验流畅舒适

---

**文档版本**：v1.0  
**创建日期**：2024年12月  
**负责人**：爱娘 (AI Assistant)  
**审核人**：素素 (Project Owner)
